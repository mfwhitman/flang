"use strict";angular.module("flangApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","ui.router"]).config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/"),a.state("main",{url:"/",templateUrl:"views/main.html",controller:"MainCtrl"}).state("about",{url:"/about:photo/:secret",templateUrl:"views/about.html",controller:"AboutCtrl"})}]),angular.module("flangApp").controller("MainCtrl",["$scope","$timeout","$location","$routeParams","$rootScope","flangPull",function(a,b,c,d,e,f){var g;a.status=!1,e.currentSearch&&(a.query=e.currentSearch,f.getSearch(e.currentSearch).then(function(b){a.retrievedPhotos=b.photos.photo})),a.search=function(){e.currentSearch=a.query,a.statusMessage="Loading...",a.status=!0,g&&b.cancel(g),g=b(function(){var b=a.query.replace(/[ ,]+/g,",");f.getSearch(b).then(function(b){a.retrievedPhotos=b.photos.photo,a.statusMessage="Done! ("+a.retrievedPhotos.length+" images found)"})},1e3)},a.info=function(a,b){c.path("/about:"+a+"/"+b)}}]),angular.module("flangApp").controller("AboutCtrl",["$scope","$stateParams","flangPull",function(a,b,c){var d=b.photo.substring(1),e=b.secret.substring(1);a.status=!0,a.statusMessage="",console.log("photo: "+d),console.log("secret: "+e),c.getSizes(d).then(function(b){var c=_.find(b.sizes.size,function(a){return"Large"===a.label});(void 0===c||null===c)&&(c=b.sizes.size[b.sizes.size.length-1]),a.image=c.source}),c.getEXIFdata(d,e).then(function(b){"ok"===b.stat?(a.status=!0,a.exifData=b.photo.exif,0===a.exifData.length&&(a.status=!1,a.statusMessage="Sorry, no EXIF data is available for this image.")):(a.status=!1,a.statusMessage="Sorry, you do not have permission to view EXIF data for this image.")})}]),angular.module("flangApp").provider("flangPull",function(){var a="https://api.flickr.com/services",b="239125bcc03d4efa36227d1e4eec735a";this.setApiKey=function(a){b=a||b},this.$get=["$q","$http",function(c,d){var e={getPublicFeed:function(e){var f=c.defer();return d({method:"JSONP",url:a+"/feeds/photos_public.gne?",params:{api_key:b,jsoncallback:"JSON_CALLBACK",format:"json",tags:e}}).success(function(a){f.resolve(a),console.log("getPublicFeed: "),console.log(a)}).error(function(a){f.reject(a)}),f.promise},getSearch:function(e){var f=c.defer();return d({method:"JSONP",url:a+"/rest/?method=flickr.photos.search&format=json",params:{api_key:b,jsoncallback:"JSON_CALLBACK",format:"json",tags:e,extras:"url_z",per_page:10}}).success(function(a){f.resolve(a),console.log("getSearch: "),console.log(a)}).error(function(a){f.reject(a)}),f.promise},getEXIFdata:function(e,f){var g=c.defer();return d({method:"JSONP",url:a+"/rest/?method=flickr.photos.getExif&format=json",params:{api_key:b,jsoncallback:"JSON_CALLBACK",format:"json",photo_id:e,secret:f}}).success(function(a){g.resolve(a),console.log("getEXIFdata: "),console.log(a)}).error(function(a){g.reject(a)}),g.promise},getSizes:function(e){var f=c.defer();return d({method:"JSONP",url:a+"/rest/?method=flickr.photos.getSizes&format=json",params:{api_key:b,jsoncallback:"JSON_CALLBACK",format:"json",photo_id:e}}).success(function(a){f.resolve(a),console.log("getSizes: "),console.log(a)}).error(function(a){f.reject(a)}),f.promise}};return e}]});